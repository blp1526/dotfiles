#!/usr/bin/env ruby

if ARGV.size != 1
  puts "Expected ARGV.size is 1, but got #{ARGV.size}."
  exit 1
end

exit_status = 1
url = ARGV[0]
git_format = /\Agit@(.+?):(.+?)\/(.+?)\.git\z/
https_format = /\Ahttps:\/\/(.+?)\/(.+?)\/(.+?)\.git\z/

[git_format, https_format].each do |format|
  if  url =~ format
    command = "git clone #{url} #{ENV['GOPATH']}/src/#{$1}/#{$2}/#{$3}"
    puts command
    result = system command
    exit_status = 0 if result
    exit exit_status
  end
end

puts "Unexpected git clone path, got #{url}."
exit exit_status
